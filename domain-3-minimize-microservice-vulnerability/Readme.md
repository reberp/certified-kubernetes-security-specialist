# Domain - Core Concepts

The code mentioned in this document are used in the Certified Kubernetes Security Specialist 2023 video course.


# Video-Document Mapper

| Sr No | Document Link |
| ------ | ------ |
| 1 | [Security Contexts](pod-securitycontext.yaml) |
| 2 | [Running Privileged PODS in Kubernetes](privileged.yaml) |
| 3 | [Hack Misconfigured Cluster](hack-case-01.md)
| 4 | [Understanding Pod Security Policy Workflow](pod-security-policy.md)
| 5 | [Implementing Restrictive Policy](psp-restrictive.md) |
| 6 | [PSP Security Consideration - Volumes](hostpath.md) |
| 7 | [PSP Security Considerations - Host PID](hostpid.md) |
| 8 | [PSP and Controllers](psp-rs.md) |
| 9 | [ImagePullPolicy in Kubernetes](image-pull-policy.md) |
| 10 | [Admission Controller - AlwaysPullImages](ac-alwayspullimages.md) |
| 11 | [Admission Controller - ImagePolicyWebhook](imagewebhook.md) |
| 12 | [Custom WebHook Integration with Admission Controller](imagepolicywebhook-custom.md) |
| 13 | [Overview of Kubernetes Secrets](secrets.md) |
| 14 | [Mounting Secrets in Pods](mounting-secrets.md) |

# Admission controller
intercepts requests to API server after authorization, but before action
two types: validating and mutating
Use case: ensure that pods with development ns go to certain node. 
Use case: pod security policy for new pods to say they aren't privileged
To turn them off/on: https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/

# Security context
Default user in container is UID 0, with a breakout they get root
Always run with least privelege user. 
Three permissons: runAsUser, runAsGroup, fsGroup

# Privileged Containers
Docker gives all capabilities. Run things like DinD. 
```
docker run --dt [image] bash
#On host: lots of devices in /dev/
docker exec -it [id] bash
ls /dev #less than what host has
#run a privileged, see it has devices and capabilities
docker run -dt --privileged [image] bash
docker exec -it [id] bash
ls /dev #everything from host
chmod +i [file] #requires capability
```

## In K8s
```
k apply -f privileged.yaml
pod/privileged created
pod/non-privileged created
capsh --print #lot lower on non-priv
```

# Hack case
User can create namespaced objects
super secret object hosting info in another NS
user creates privileged pod in his NS
Hacker gets onto user pod somehow
* they can  read other secret pod
* they can edit host files
* they can get kube certificates, run static pods, etc. 
# Admission controller Built Ins
## AlwaysPull
Modifies pods to force them to always pull
Dev can't use a different container than designed to allow them to access things. 
Forces authentication for an image to be used since there's no auth if it's cached.

## ImagePolicyWebhook
Can deny pulls of specific image or types of images, like using latest tag
Can test local with kube-config-bouncer